<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ç–∞–ª–æ–≥–∞ (–æ—Ñ–ª–∞–π–Ω)</title>
  
  <style>
    :root {
      --primary: #4a6da7;
      --accent: #C9897B;
      --bg: #f7f8fb;
      --card: #fff;
      --text: #2b2d33;
      --muted: #667085;
      --border: #e5e7eb;
      --success: #2e7d32;
      --danger: #c62828;
      --warning: #b26a00;
    }
    * { box-sizing: border-box; }
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background: var(--bg); color: var(--text); margin: 0; }
    header { position: sticky; top:0; z-index:10; background:linear-gradient(90deg,#4a6da7,#87c0cd); color:#fff; padding:14px 20px; box-shadow:0 2px 10px rgba(0,0,0,.05); }
    header .title { font-size: 18px; font-weight: 600; }
    main { padding: 24px; max-width: 1440px; margin: 0 auto; }
    .hint { color: #eef2ff; opacity: .95; font-size: 13px; }
    .toolbar { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 10px; }
    .toolbar .spacer { flex: 1; }
    .toolbar .status { font-size: 12px; color: #e5f7ea; }
    .toolbar .status.saved::before { content: '‚óè '; color: #7dd87d; }
    .toolbar .status.warn::before { content: '‚óè '; color: #ffd166; }

    .btn { padding: 9px 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; box-shadow: 0 1px 2px rgba(0,0,0,.06); }
    .btn.primary { background: var(--accent); color:#fff; }
    .btn.secondary { background: #eef2ff; color: #1f2937; }
    .btn.ghost { background: transparent; color:#fff; border:1px solid #ffffff33; }
    .btn.danger { background: #fee2e2; color: var(--danger); }
    .file-label { padding: 9px 12px; border:1px dashed #ffffff77; border-radius: 10px; color:#fff; cursor:pointer; }
    .file-label input { display:none; }
    
    .grid { display: grid; grid-template-columns: 360px 1fr 1fr; gap: 24px; align-items: start; margin-top: 18px; }
    .card { border: 1px solid var(--border); border-radius: 16px; padding: 16px; background: var(--card); box-shadow: 0 4px 14px rgba(0,0,0,.04); }
    .card h2 { margin: 0 0 12px 0; font-size: 18px; }
    .section-actions { display:flex; gap:8px; align-items:center; margin: 8px 0 12px; }
    .row { display: grid; grid-template-columns: 220px 1fr; gap: 12px; align-items: center; margin-bottom: 10px; }
    input[type="text"], input[type="number"], textarea, select { width: 100%; padding: 12px 14px; border: 1px solid var(--border); border-radius: 10px; background:#fff; font-size: 15px; }
    textarea { min-height: 72px; }

    .two { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .list { margin-top: 10px; max-height: 480px; overflow: auto; border: 1px solid var(--border); border-radius: 12px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 12px; border-bottom: 1px solid #f2f4f7; font-size: 14px; text-align:left; }
    th { position: sticky; top: 0; background: #f9fafb; z-index: 1; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; color:#475467; }
    .note { font-size: 12px; color: var(--muted); margin-top:8px; }
    .pill { display:inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; background:#eef2ff; color:#334155; }
    .right { text-align: right; }
    /* ‚Äî‚Äî‚Äî UI —É–ª—É—á—à–µ–Ω–∏—è ‚Äî‚Äî‚Äî */
    .note.strong { color:#475467; font-weight:600; }
    .row > label { font-weight:600; color:#334155; display:flex; align-items:center; gap:6px; }
    .req { color: var(--danger); font-weight: 700; margin-left: 2px; }
    input[type="text"], input[type="number"], textarea, select { transition: border-color .15s, box-shadow .15s, background-color .15s; }
    input[type="text"]:focus, input[type="number"]:focus, textarea:focus, select:focus { outline: none; border-color: #93c5fd; box-shadow: 0 0 0 3px #93c5fd33; background:#fff; }
    .btn { transition: transform .04s ease, background-color .15s; }
    .btn:hover { transform: translateY(-1px); }
    .btn.primary { box-shadow: 0 1px 2px rgba(0,0,0,.08); }
    .btn.primary:hover { filter: brightness(0.97); }
    .btn.secondary:hover { background:#e3e8ff; }
    .btn.danger:hover { background:#ffdfe0; }
    .card h2 { display:flex; align-items:center; gap:10px; }
    .lead { margin: 8px 0 14px; color:#475467; font-size: 13px; }
    .hint-inline { font-size:12px; color:#667085; }
    .stepper { display:flex; gap:16px; align-items:center; margin: 8px 0 2px; flex-wrap: wrap; }
    .stepper .step { display:flex; align-items:center; gap:8px; color:#334155; background:#ffffff; border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-size:13px; }
    .stepper .num { width:22px; height:22px; display:inline-grid; place-items:center; background:#eef2ff; color:#334155; border-radius:999px; font-weight:700; }
    table tbody tr:nth-child(odd) { background:#fafbff; }
    table tbody tr:hover { background:#f3f6ff; }
  </style>
  <script src="api-client.js"></script>
  <script>
    let lastSaveTimer;

    function markSaved(msg='–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ'){ const s = document.getElementById('saveStatus'); s.textContent = msg; s.className = 'status saved'; clearTimeout(lastSaveTimer); lastSaveTimer = setTimeout(()=>{ s.textContent = '–ì–æ—Ç–æ–≤–æ'; }, 2000); }
    function markWarn(msg){ const s = document.getElementById('saveStatus'); s.textContent = msg; s.className = 'status warn'; }

    // ‚Äî‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–µ—Ö.–ø–æ–ª–µ–π ‚Äî‚Äî
    function transliterateRuToLat(str){
      const map = { '–∞':'a','–±':'b','–≤':'v','–≥':'g','–¥':'d','–µ':'e','—ë':'e','–∂':'zh','–∑':'z','–∏':'i','–π':'y','–∫':'k','–ª':'l','–º':'m','–Ω':'n','–æ':'o','–ø':'p','—Ä':'r','—Å':'s','—Ç':'t','—É':'u','—Ñ':'f','—Ö':'h','—Ü':'c','—á':'ch','—à':'sh','—â':'shch','—ä':'','—ã':'y','—å':'','—ç':'e','—é':'yu','—è':'ya' };
      return (str||'').split('').map(ch=>{
        const lower = ch.toLowerCase();
        const rep = map[lower];
        if (rep===undefined) return ch;
        return ch===lower ? rep : rep.toUpperCase();
      }).join('');
    }
    const slugify = (text) => {
      const pre = transliterateRuToLat((text||'').toString());
      return pre
        .normalize('NFKD')
        .replace(/\p{Diacritic}+/gu, '')
        .replace(/[^a-zA-Z0-9\s-_]+/g, '')
        .trim()
        .replace(/[\s_]+/g, '-')
        .toLowerCase();
    };

    function nextId(kind){
      const st = store();
      const arr = st[kind] || [];
      const max = arr.reduce((m, r)=> Math.max(m, Number(r.id)||0), 0);
      return max + 1;
    }

    function ensureUniqueCode(kind, baseCode){
      const st = store();
      const arr = st[kind] || [];
      const base = slugify(baseCode||'');
      if (!base) return '';
      let code = base; let i = 1;
      const exists = (c)=> arr.some(r=> String(r.code||'').toLowerCase() === String(c).toLowerCase());
      while (exists(code)) { code = `${base}-${i++}`; }
      return code;
    }

    function generateSku(prod){
      const cat = slugify(prod.category||'').replace(/-/g,'').slice(0,3).toUpperCase();
      const sub = slugify(prod.subcategory_code||'').replace(/-/g,'').slice(0,3).toUpperCase();
      const title = slugify(prod.title||'').replace(/-/g,'').slice(0,4).toUpperCase();
      const idPart = String(prod.id||'').padStart(4,'0').slice(-4);
      return [cat, sub||'GEN', title||'PRD', idPart].filter(Boolean).join('-');
    }

    function loadDefaults(){
      const cats = (window.LOCAL_CATEGORIES||[]).slice();
      const subs = (window.LOCAL_SUBCATEGORIES||[]).slice();
      const prods = (window.LOCAL_PRODUCTS||[]).slice();
      return { categories: cats, subcategories: subs, products: prods };
    }
    function loadCustom(){ try { return JSON.parse(localStorage.getItem('CUSTOM_CATALOG_V1')||'null'); } catch { return null; } }
    function saveCustom(data){ localStorage.setItem('CUSTOM_CATALOG_V1', JSON.stringify(data)); markSaved(); }
    function store(){ return loadCustom() || loadDefaults(); }

    function byId(id){ return document.getElementById(id); }

    function rebuildSelects(){
      const data = store();
      // –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ code
      const catOptions = data.categories.map(c=>({ value:c.code, label:`${c.name} (${c.code})` }));
      // –ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      const subCatSel = byId('sub_cat_code');
      buildOptions(subCatSel, catOptions, '‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Äî');
      // –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞
      const pCatSel = byId('p_category');
      buildOptions(pCatSel, catOptions, '‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Äî');
      // –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
      buildProductSubcats();
    }

    function buildOptions(selectEl, options, placeholder){
      const current = selectEl.value;
      selectEl.innerHTML = '';
      const ph = document.createElement('option'); ph.value=''; ph.textContent = placeholder; selectEl.appendChild(ph);
      options.forEach(o=>{ const op=document.createElement('option'); op.value=o.value; op.textContent=o.label; selectEl.appendChild(op); });
      if ([...selectEl.options].some(o=>o.value===current)) selectEl.value = current;
    }

    function buildProductSubcats(){
      const data = store();
      const catCode = byId('p_category').value;
      const scSel = byId('p_subcat');
      const relevant = data.subcategories.filter(s=>s.category_code && s.category_code.toLowerCase() === (catCode||'').toLowerCase())
        .map(s=>({ value:s.code, label:`${s.name} (${s.code})` }));
      buildOptions(scSel, relevant, '‚Äî (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) ‚Äî');
    }

    function refreshPreview(){
      const custom = loadCustom();
      const data = store();
      byId('catsCount').textContent = data.categories.length;
      byId('subsCount').textContent = data.subcategories.length;
      byId('prodsCount').textContent = data.products.length;

      renderTable('catsTable', data.categories, [
        {key:'id', label:'id'},
        {key:'name', label:'–ù–∞–∑–≤–∞–Ω–∏–µ'},
        {key:'code', label:'–ö–æ–¥'},
        {key:'image_url', label:'–ö–∞—Ä—Ç–∏–Ω–∫–∞'}
      ], 'categories');

      renderTable('subsTable', data.subcategories, [
        {key:'id', label:'id'},
        {key:'name', label:'–ù–∞–∑–≤–∞–Ω–∏–µ'},
        {key:'code', label:'–ö–æ–¥'},
        {key:'category_code', label:'–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–∫–æ–¥)'},
        {key:'_catName', label:'–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–∑–≤–∞–Ω–∏–µ)'}
      ], 'subcategories');

      renderTable('prodsTable', data.products, [
        {key:'id', label:'id'},
        {key:'title', label:'–ù–∞–∑–≤–∞–Ω–∏–µ'},
        {key:'price', label:'–¶–µ–Ω–∞'},
        {key:'category', label:'–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–∫–æ–¥)'},
        {key:'_catName', label:'–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–∑–≤–∞–Ω–∏–µ)'},
        {key:'subcategory_code', label:'–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è (–∫–æ–¥)'},
        {key:'_subName', label:'–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–∑–≤–∞–Ω–∏–µ)'}
      ], 'products');

      byId('activeSource').textContent = (custom ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (localStorage)' : '–î–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (local-data.js)');
      rebuildSelects();
      markSaved('–ì–æ—Ç–æ–≤–æ');
    }

    function withDecor(row){
      const data = store();
      if (row.category_code){
        const cat = data.categories.find(c=>c.code && c.code.toLowerCase()===row.category_code.toLowerCase());
        row._catName = cat ? cat.name : '';
      }
      if (row.category){
        const cat = data.categories.find(c=>c.code && c.code.toLowerCase()===row.category.toLowerCase());
        row._catName = cat ? cat.name : '';
      }
      if (row.subcategory_code){
        const sub = data.subcategories.find(s=>s.code && s.code.toLowerCase()===row.subcategory_code.toLowerCase());
        row._subName = sub ? sub.name : '';
      }
      return row;
    }

    function renderTable(tableId, rows, cols, kind){
      const el = byId(tableId);
      el.innerHTML = '';
      const thead = document.createElement('thead');
      thead.innerHTML = '<tr>' + cols.map(c=>`<th>${c.label}</th>`).join('') + '<th class="right">–î–µ–π—Å—Ç–≤–∏—è</th></tr>';
      el.appendChild(thead);
      const tbody = document.createElement('tbody');
      rows.map(r=>withDecor({...r})).forEach((r, i)=>{
        const tr = document.createElement('tr');
        cols.forEach(c=>{
          const td = document.createElement('td');
          const val = r[c.key];
          td.innerHTML = (c.key==='price' && typeof val==='number') ? `<span class="mono">${val.toLocaleString('ru-RU')} ‚ÇΩ</span>` : `<span class="mono">${val!==undefined? val : ''}</span>`;
          tr.appendChild(td);
        });
        const tdAct = document.createElement('td'); tdAct.className = 'right';
        const del = document.createElement('button'); del.textContent = '–£–¥–∞–ª–∏—Ç—å'; del.className = 'btn danger';
        del.onclick = ()=>{ const st = store(); st[kind].splice(i,1); saveCustom(st); refreshPreview(); };
        tdAct.appendChild(del);
        tr.appendChild(tdAct);
        tbody.appendChild(tr);
      });
      el.appendChild(tbody);
    }

    function addCategory(){
      const st = store();
      const cat = {
        id: Number(byId('cat_id').value||0) || nextId('categories'),
        name: byId('cat_name').value.trim(),
        code: byId('cat_code').value.trim(),
        image_url: byId('cat_image').value.trim()
      };
      if (!cat.code && cat.name){ cat.code = ensureUniqueCode('categories', cat.name); byId('cat_code').value = cat.code; }
      if (!cat.id || !cat.name || !cat.code){ return markWarn('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ id, name, code'); }
      if (st.categories.some(c=>String(c.id)===String(cat.id))) { return markWarn('id –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); }
      if (st.categories.some(c=>c.code.toLowerCase()===cat.code.toLowerCase())) { return markWarn('code –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); }
      st.categories.push(cat); saveCustom(st); refreshPreview();
      ['cat_id','cat_name','cat_code','cat_image'].forEach(id=>byId(id).value='');
    }

    function addSubcategory(){
      const sub = {
        id: Number(byId('sub_id').value||0) || nextId('subcategories'),
        name: byId('sub_name').value.trim(),
        code: byId('sub_code').value.trim(),
        category_code: byId('sub_cat_code').value.trim()
      };
      if (!sub.code && sub.name){ sub.code = ensureUniqueCode('subcategories', sub.name); byId('sub_code').value = sub.code; }
      const st = store();
      if (!sub.id || !sub.name || !sub.code || !sub.category_code){ return markWarn('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ id, name, code, category_code'); }
      if (!st.categories.some(c=>c.code.toLowerCase()===sub.category_code.toLowerCase())){ return markWarn('category_code –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö'); }
      if (st.subcategories.some(s=>String(s.id)===String(sub.id))) { return markWarn('id –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); }
      if (st.subcategories.some(s=>s.code.toLowerCase()===sub.code.toLowerCase())) { return markWarn('code –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); }
      st.subcategories.push(sub); saveCustom(st); refreshPreview();
      ['sub_id','sub_name','sub_code','sub_cat_code'].forEach(id=>byId(id).value='');
    }

    function addProduct(){
      const prod = {
        id: Number(byId('p_id').value||0) || nextId('products'),
        title: byId('p_title').value.trim(),
        price: Number(byId('p_price').value||0),
        image_url: byId('p_image').value.trim(),
        category: byId('p_category').value.trim(),
        subcategory_code: byId('p_subcat').value.trim(),
        description: byId('p_desc').value.trim(),
        sku: byId('p_sku').value.trim()
      };
      if (!prod.sku){ const auto = generateSku(prod); if (auto){ prod.sku = auto; byId('p_sku').value = prod.sku; } }
      const st = store();
      if (!prod.id || !prod.title || !prod.price || !prod.category){ return markWarn('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ id, title, price, category'); }
      if (!st.categories.some(c=>c.code.toLowerCase()===prod.category.toLowerCase())){ return markWarn('category (–∫–æ–¥) –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö'); }
      if (prod.subcategory_code && !st.subcategories.some(s=>s.code.toLowerCase()===prod.subcategory_code.toLowerCase())){ return markWarn('subcategory_code –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö'); }
      if (st.products.some(p=>String(p.id)===String(prod.id))) { return markWarn('id —Ç–æ–≤–∞—Ä–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); }
      st.products.push(prod); saveCustom(st); refreshPreview();
      ['p_id','p_title','p_price','p_image','p_category','p_subcat','p_desc','p_sku'].forEach(id=>byId(id).value='');
    }

    function clearCustom(){ if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞?')) return; localStorage.removeItem('CUSTOM_CATALOG_V1'); refreshPreview(); }
    function clearSection(kind){ const st = store(); if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å —Ä–∞–∑–¥–µ–ª?')) return; st[kind] = []; saveCustom(st); refreshPreview(); }

    function exportJson(){ const data = store(); const blob=new Blob([JSON.stringify(data, null, 2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='catalog.json'; a.click(); }
    function handleImport(file){ const reader=new FileReader(); reader.onload=()=>{ try{ const data=JSON.parse(reader.result); if(!data||!Array.isArray(data.categories)||!Array.isArray(data.subcategories)||!Array.isArray(data.products)){ alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞'); return;} saveCustom({categories:data.categories, subcategories:data.subcategories, products:data.products}); refreshPreview(); }catch(e){ alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: '+e.message);} }; reader.readAsText(file); }

    document.addEventListener('DOMContentLoaded', ()=>{
      refreshPreview();
      byId('importFile').addEventListener('change', (e)=>{ if (e.target.files && e.target.files[0]) handleImport(e.target.files[0]); });
      byId('p_category').addEventListener('change', buildProductSubcats);

      // –ñ–∏–≤–∞—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è
      let catCodeDirty=false, subCodeDirty=false;
      byId('cat_code').addEventListener('input', ()=>{ catCodeDirty = !!byId('cat_code').value.trim(); });
      byId('cat_name').addEventListener('input', ()=>{ if (!catCodeDirty) { const v=ensureUniqueCode('categories', byId('cat_name').value); byId('cat_code').value=v; }});
      byId('sub_code').addEventListener('input', ()=>{ subCodeDirty = !!byId('sub_code').value.trim(); });
      byId('sub_name').addEventListener('input', ()=>{ if (!subCodeDirty) { const v=ensureUniqueCode('subcategories', byId('sub_name').value); byId('sub_code').value=v; }});
      // –ê–≤—Ç–æ ID –ø–æ —Ñ–æ–∫—É—Å—É, –µ—Å–ª–∏ –ø—É—Å—Ç–æ
      byId('cat_id').addEventListener('focus', ()=>{ if(!byId('cat_id').value) byId('cat_id').value = nextId('categories'); });
      byId('sub_id').addEventListener('focus', ()=>{ if(!byId('sub_id').value) byId('sub_id').value = nextId('subcategories'); });
      byId('p_id').addEventListener('focus',  ()=>{ if(!byId('p_id').value)  byId('p_id').value  = nextId('products'); });
      // SKU –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
      ['p_title','p_category','p_subcat','p_id'].forEach(id=>{
        byId(id).addEventListener('input', ()=>{ if(!byId('p_sku').value.trim()){ const p={ id: Number(byId('p_id').value||0)||nextId('products'), title: byId('p_title').value, category: byId('p_category').value, subcategory_code: byId('p_subcat').value }; byId('p_sku').value = generateSku(p); } });
      });
    });
  </script>
</head>
<body>
  <header>
    <div class="title">–†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ç–∞–ª–æ–≥–∞ (–æ—Ñ—Ñ–ª–∞–π–Ω)</div>
    <div class="toolbar">
      <button class="btn ghost" onclick="location.href='index.html'">–û—Ç–∫—Ä—ã—Ç—å –≤–∏—Ç—Ä–∏–Ω—É</button>
      <button class="btn ghost" onclick="location.href='desktop.html'">Desktop</button>
      <button class="btn ghost" onclick="location.href='mobile.html'">Mobile</button>
      <span class="spacer"></span>
      <button class="btn secondary" onclick="exportJson()">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
      <label class="file-label">–ò–º–ø–æ—Ä—Ç JSON<input id="importFile" type="file" accept="application/json"></label>
      <button class="btn danger" onclick="clearCustom()">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</button>
      <span id="saveStatus" class="status">–ì–æ—Ç–æ–≤–æ</span>
    </div>
    <div class="hint">–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ (localStorage). –í–∏—Ç—Ä–∏–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ.</div>
  </header>

  <main>
    <!-- –®–∞–≥–∏ –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞ -->
    <div class="stepper" role="list" aria-label="–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π">
      <div class="step" role="listitem"><span class="num">1</span><span>–î–æ–±–∞–≤—å—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span></div>
      <div class="step" role="listitem"><span class="num">2</span><span>–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span></div>
      <div class="step" role="listitem"><span class="num">3</span><span>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã</span></div>
    </div>
    <p class="note strong">–ü–æ–ª—è, –ø–æ–º–µ—á–µ–Ω–Ω—ã–µ <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span>, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.</p>
    <div class="grid">
      <div class="card">
        <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ <span class="pill" id="catsCount">0</span></h2>
        <p class="lead">–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –≥—Ä—É–ø–ø—ã —Ç–æ–≤–∞—Ä–æ–≤. –ú–∏–Ω–∏–º—É–º: ID, –ù–∞–∑–≤–∞–Ω–∏–µ –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ö–æ–¥.</p>
        <div class="section-actions">
          <button class="btn danger" onclick="clearSection('categories')">üßπ –û—á–∏—Å—Ç–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
        </div>
        <div class="row"><label>ID <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span></label><input id="cat_id" type="number" placeholder="–ù–∞–ø—Ä. 10" title="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π —á–∏—Å–ª–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"></div>
        <div class="row"><label>–ù–∞–∑–≤–∞–Ω–∏–µ <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span></label><input id="cat_name" type="text" placeholder="–ù–∞–ø—Ä. –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" title="–ò–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"></div>
        <div class="row"><label>–ö–æ–¥ <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span></label><input id="cat_code" type="text" placeholder="–ù–∞–ø—Ä. electronics" title="–ö–æ–¥ –Ω–∞ –ª–∞—Ç–∏–Ω–∏—Ü–µ, –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º"></div>
        <div class="row"><label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ <span class="hint-inline">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label><input id="cat_image" type="text" placeholder="/images/cat-electronics.jpg" title="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"></div>
        <div class="section-actions">
          <button class="btn primary" onclick="addCategory()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
        </div>
        <div class="list"><table id="catsTable"></table></div>
        <div class="note">–ò—Å—Ç–æ—á–Ω–∏–∫ —Å–µ–π—á–∞—Å: <strong id="activeSource"></strong></div>
      </div>

      <div class="card">
        <h2>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ <span class="pill" id="subsCount">0</span></h2>
        <p class="lead">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Ç–æ—á–Ω—è—é—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é. –í—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã. –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.</p>
        <div class="section-actions">
          <button class="btn danger" onclick="clearSection('subcategories')">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
        </div>
        <div class="row"><label>ID <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span></label><input id="sub_id" type="number" placeholder="–ù–∞–ø—Ä. 101" title="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π —á–∏—Å–ª–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏"></div>
        <div class="row"><label>–ù–∞–∑–≤–∞–Ω–∏–µ <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span></label><input id="sub_name" type="text" placeholder="–ù–∞–ø—Ä. –ü—ã–ª–µ—Å–æ—Å—ã" title="–ò–º—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏"></div>
        <div class="row"><label>–ö–æ–¥ <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span></label><input id="sub_code" type="text" placeholder="–ù–∞–ø—Ä. vacuum" title="–ö–æ–¥ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ –ª–∞—Ç–∏–Ω–∏—Ü–µ"></div>
        <div class="row"><label>–ö–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span></label>
          <select id="sub_cat_code" title="–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é"></select>
        </div>
        <div class="section-actions">
          <button class="btn primary" onclick="addSubcategory()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
        </div>
        <div class="list"><table id="subsTable"></table></div>
      </div>

      <div class="card" style="grid-column: 1 / span 3;">
        <h2>–¢–æ–≤–∞—Ä—ã <span class="pill" id="prodsCount">0</span></h2>
        <p class="lead">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: ID, –ù–∞–∑–≤–∞–Ω–∏–µ, –¶–µ–Ω–∞ –∏ –ö–∞—Ç–µ–≥–æ—Ä–∏—è. –û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ø–æ –∂–µ–ª–∞–Ω–∏—é.</p>
        <div class="section-actions">
          <button class="btn danger" onclick="clearSection('products')">üßπ –û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</button>
        </div>
        <div class="two">
          <div class="row"><label>ID <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span></label><input id="p_id" type="number" placeholder="–ù–∞–ø—Ä. 1001" title="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–≤–∞—Ä–∞"></div>
          <div class="row"><label>–ù–∞–∑–≤–∞–Ω–∏–µ <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span></label><input id="p_title" type="text" placeholder="–ù–∞–ø—Ä. –†–æ–±–æ—Ç-–ø—ã–ª–µ—Å–æ—Å X1" title="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"></div>
          <div class="row"><label>–¶–µ–Ω–∞ <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span></label><input id="p_price" type="number" placeholder="–ù–∞–ø—Ä. 19990" title="–¶–µ–Ω–∞ –≤ —Ä—É–±."></div>
          <div class="row"><label>SKU <span class="hint-inline">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label><input id="p_sku" type="text" placeholder="–ù–∞–ø—Ä. X1-2025" title="–ê—Ä—Ç–∏–∫—É–ª"></div>
          <div class="row"><label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ <span class="hint-inline">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label><input id="p_image" type="text" placeholder="/images/robot-x1.jpg" title="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏"></div>
          <div class="row"><label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–∫–æ–¥) <span class="req" title="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ">*</span></label>
            <select id="p_category" title="–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é"></select>
          </div>
          <div class="row"><label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è (–∫–æ–¥) <span class="hint-inline">(–µ—Å–ª–∏ –µ—Å—Ç—å)</span></label>
            <select id="p_subcat" title="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"></select>
          </div>
        </div>
        <div class="row"><label>–û–ø–∏—Å–∞–Ω–∏–µ <span class="hint-inline">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label><textarea id="p_desc" placeholder="–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ" title="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"></textarea></div>
        <div class="section-actions">
          <button class="btn primary" onclick="addProduct()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
        </div>
        <div class="list"><table id="prodsTable"></table></div>
      </div>
    </div>

    <p class="note">–ü–æ–¥—Å–∫–∞–∑–∫–∞:
      <br>- –ß—Ç–æ–±—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ¬´–û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä—ã/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏¬ª.
      <br>- –í–∏—Ç—Ä–∏–Ω–∞ –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—ã—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
    </p>
  </main>

</body>
</html> 